
#include "button.h"



BUTTON_CONTROL button[3]=
	{
			{GPIOB,GPIO_PIN_3,0},
			{GPIOB,GPIO_PIN_5,0},
			{GPIOB,GPIO_PIN_4,0}
	};

//blocking 코드

//bool buttonGetPressed(uint8_t num)
//{
//	bool ret = false;
//
//	if(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
//	{
//		HAL_Delay(20);
//		if(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
//		{
//			ret = true;
//		}
//	}
//	return ret;
//}

//-----------------non-blocking----------------------------------------------------------


//bool buttonGetPressed(uint8_t num)
//{
//	static uint32_t prevTime = 0;  //최초 첫번째 디바운스 안됨
//
//	bool ret = false;
//
//	if(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
//	{
//		uint32_t currTime = HAL_GetTick();
//
//		if (currTime- prevTime >50)
//		{
//			f(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
//					{
//						ret = true;
//					}
//			prevTime = currTime;
//		}
//	}
//	return ret;
//}

//--------------------non-blocking2-------------------------------------

//bool buttonGetPressed(uint8_t num)
//{
//	static uint32_t prevTime = 0xFFFFFFFF;  //최초 첫번째 디바운스 안됨
//
//	if(prevTime == 0xFFFFFFFF)
//	{
//		preTime = HAL_GetTick();
//	}
//
//	bool ret = false;
//
//	if(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
//	{
//		uint32_t currTime = HAL_GetTick();
//
//		if (currTime- prevTime >50)
//		{
//			f(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
//					{
//						ret = true;
//					}
//			prevTime = currTime;
//		}
//	}
//	return ret;
//}

//-------------------------non blocking3 ------------------

bool buttonGetPressed(uint8_t num)
{
	static uint32_t prevTime[3] = {0xFFFFFFFF};  //최초 첫번째 디바운스 안됨

	if(prevTime[num] == 0xFFFFFFFF)
	{
		prevTime[num] = HAL_GetTick();
	}

	bool ret = false;

	if(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
	{
		uint32_t currTime = HAL_GetTick();

		if (currTime- prevTime[num] >50)
		{
			if(HAL_GPIO_ReadPin(button[num].port, button[num].pinNumber) == button[num].onState)
					{
						ret = true;
					}
			prevTime[num] = currTime;
		}
	}
	return ret;
}



